![[Weixin Image_20250312144821.jpg]]
When a wheelchair transitions from **standing mode back to a seated position** or **travels downhill**, the motor enters **generator mode**. If this energy is not utilized, it is wasted and dissipates as heat. By using a **regenerative braking system**, this energy can be recovered and stored in a **battery or supercapacitor (SuperCap)**, thereby extending the wheelchairâ€™s battery life.

---

## **1. The Physics of Energy Recovery During Descent**

When the wheelchair moves from a standing position back to a seated position, the motor (typically a **brushless DC motor (BLDC)** or **permanent magnet synchronous motor (PMSM)**) operates differently:

- **Normal Mode (Lifting)** â†’ The motor acts as a **motor**, converting electrical energy into mechanical energy.
- **Descent Mode (Energy Recovery)** â†’ The motor acts as a **generator**, driven by gravity, producing **reverse current (regenerative current)**.

If energy recovery is not implemented, the motor will dissipate this energy as **heat** through a braking resistor. To store this recovered energy, a **regenerative circuit** is needed to direct the captured energy into a **battery or supercapacitor**.

---

## **2. Hardware Architecture for Energy Recovery**

To implement regenerative braking, we need:

1. **H-Bridge Inverter (Motor Controller)** â†’ Allows the motor to operate in generator mode.
2. **Bidirectional DC-DC Converter** â†’ Controls energy flow to the battery or supercapacitor.
3. **Supercapacitor (SuperCap) + Battery Management System (BMS)** â†’ Buffers and stores the recovered energy.

### **ðŸ”§ Hardware Architecture Diagram**

```
Motor (BLDC)  
   â†“  
H-Bridge Inverter (FOC Control)  
   â†“  
Bidirectional DC-DC Converter  
   â”œâ”€â”€> SuperCap (Short-term storage)  
   â”œâ”€â”€> Battery (Long-term storage)  
```

---

## **3. Software Control Strategy**

For effective energy recovery, an MCU (such as STM32, ESP32, or RP2040) is required to dynamically adjust energy flow. The control strategy includes:

- **Switching to regenerative braking mode when a descent is detected**.
- **Monitoring battery voltage to prevent overcharging**.
- **Using PWM to control the DC-DC converter and direct recovered energy into the supercapacitor or battery**.

### **(1) FOC Inverter Control**

In the Field-Oriented Control (FOC) algorithm, normally **Id (direct-axis current) controls magnetic flux, and Iq (quadrature-axis current) controls torque**. In regenerative braking mode:

- **Adjust Iq direction so the motor operates in generator mode**.
- **Monitor the bus voltage to ensure efficient energy transfer to the battery**.

```c
void regenerative_braking(float speed, float battery_voltage) {
    if (speed < 0 && battery_voltage < MAX_VOLTAGE) {  // Descending and battery not full
        Iq_ref = -Iq_ref;  // Reverse current to enable generation
        adjust_DC_DC_converter();  // Adjust DC-DC converter
    }
}
```

---

### **(2) Bidirectional DC-DC Converter**

The regenerative voltage from the motor may be **higher or lower** than the battery voltage, requiring a **bidirectional DC-DC converter** to regulate voltage for efficient charging. The control strategy is:

- **Buck Mode (Step-down)** â†’ If motor voltage is higher than battery voltage (e.g., 48V â†’ 24V), step-down conversion is used.
- **Boost Mode (Step-up)** â†’ If motor voltage is lower than battery voltage (e.g., 12V â†’ 24V), step-up conversion is used.

```c
void adjust_DC_DC_converter() {
    if (motor_voltage > battery_voltage) {
        set_Buck_Mode();  // Step-down mode
    } else {
        set_Boost_Mode(); // Step-up mode
    }
}
```

---

### **(3) Supercapacitor (SuperCap) Management**

The supercapacitor is used for **short-term energy storage**. When the battery cannot charge rapidly, energy is first stored in the supercapacitor and later transferred gradually to the battery to prevent overcharging or damage.

**Strategy:**

- **If the supercapacitor is not full**, energy is first stored in it.
- **If the supercapacitor is full**, energy is then transferred to the battery.

```c
if (superCap_voltage < superCap_max) {
    charge_SuperCap();
} else {
    charge_Battery();
}
```

---

## **4. Regenerative Braking Implementation Example (Python)**

For control using Raspberry Pi or ESP32, the following implementation demonstrates a basic energy recovery logic:

```python
class WheelchairRegeneration:
    def __init__(self):
        self.battery_voltage = 24.0  # 24V battery
        self.motor_voltage = 30.0  # Voltage generated by the motor
        self.supercap_voltage = 12.0  # Initial voltage of the supercapacitor

    def regenerative_braking(self, speed):
        if speed < 0:  # Descending
            if self.motor_voltage > self.battery_voltage:
                self.buck_converter()  # Step-down to charge battery
            elif self.supercap_voltage < 15.0:
                self.charge_supercap()  # Charge supercapacitor
            else:
                self.dump_energy()  # Dump excess energy as heat

    def buck_converter(self):
        print("Activating Buck Converter: Charging battery...")

    def charge_supercap(self):
        print("Charging SuperCap...")

    def dump_energy(self):
        print("No storage available, dumping energy as heat.")

wheelchair = WheelchairRegeneration()
wheelchair.regenerative_braking(-1)  # Trigger energy recovery during descent
```

---

## **5. Key Optimization Strategies**

- **Regenerative Current Optimization**: Prevents excessive current from damaging the battery by optimizing the charging strategy.
- **Temperature Monitoring**: Ensures battery temperature does not exceed safe levels.
- **AI-Based Energy Distribution Learning**: Uses AI to predict user behavior and optimize energy distribution between the battery and supercapacitor.

---

## **Summary**

|**Technology**|**Function**|**Implementation**|
|---|---|---|
|**FOC Inverter Control**|Switches the motor to generator mode|Adjusts Iq direction to enable regeneration|
|**Bidirectional DC-DC Converter**|Regulates voltage for efficient energy recovery|Uses Buck-Boost circuitry|
|**Supercapacitor (SuperCap)**|Short-term energy storage to reduce battery load|Stores energy in SuperCap first, then transfers to battery|
|**Battery Management System (BMS)**|Monitors battery status and prevents overcharging|MCU monitors battery voltage & temperature|

ðŸš€ **Implementing this strategy in wheelchairs can effectively extend battery life, reduce energy waste, and make electric wheelchairs more intelligent and efficient!**